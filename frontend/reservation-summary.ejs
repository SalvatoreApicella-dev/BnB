
<div class="container">

  <h2 class="my-4 text-center">Riepilogo della prenotazione</h2>

  <div class="row">

    <div class="col-md-8 mb-4">

      <div class="card">

        <form class="card-body" id="reservation-form">

          <h3 class="my-4 " style="color: rgb(41, 65, 65);">Pernottamento a <%= apartment.name %></h3>

          <div class="row">

            <div class="col-md-6 mb-2">

                <div class="md-form ">        
                  <h5 class="my-4 " style="color: rgb(41, 65, 65);"> 
                    <%= apartment.address.street %> <%= apartment.address.street_number %>,
                    <%= apartment.address.town %> <%= apartment.address.province %>, <%= apartment.address.country %></h5>
                </div>

            </div>
          </div>

          <div class="row">

            <div class="col-md-6 mb-3">
              <div class="card text-white bg-primary">
                <div class="card-header text-center">Check-in</div>
                <div class="card-body text-center">
                  <%= moment(reservation.checkin).format('DD/MM/YYYY') %>
                </div>
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <div class="card text-white bg-primary">
                <div class="card-header text-center">Check-Out</div>
                <div class="card-body text-center">
                  <%= moment(reservation.checkout).format('DD/MM/YYYY') %>
                </div>
              </div>
            </div>

          </div>

          <hr>

          <div class="row">
            <div class="col-md-8 mb-3">
              <h3 class="my-4 text-left" style="color: rgb(41, 65, 65);">Caricamento dati degli ospiti</h3>
            </div>       
            <div class="col-md-4 mt-4">
              <button id="add-guest-form" class="btn btn-primary">Aggiungi ospite</button>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div id="guests-forms"></div>
            </div>     
          </div>
              
          <hr class="mb-4">
          <button class="btn btn-primary btn-lg btn-block" type="submit">Continua al checkout</button>

        </form>

      </div>

    </div>

    <div class="col-md-4 mb-4">

          <ul class="list-group mb-3 z-depth-1">

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0"><%= apartment.name %></h6>
                <small class="text-muted"><%= apartment.address.street %></small>
              </div>
              <img src="https://a0.muscache.com/im/pictures/57759434/84f7b345_original.jpg?aki_policy=large" style="width: 60px; height: 60px;" class="rounded float-right" alt="...">
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">

              <div>
                <label for="users"><span class="fas fa-users"></span> <%= reservation.guestsadults %> Adulti</label>
                <br>
                <label for="users"><span class="fas fa-users"></span> <%= reservation.guestschildren %> Bambini</label>
                <br>
                <label for="users"><span class="fas fa-users"></span> <%= reservation.guestsnewborns %> Neonati</label>
                <hr>
                <label for="users"><span class="fas fa-users"></span> <%= reservation.guests %> Totali</label>
              </div>

            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <label for="calendar"><span class="fas fa-calendar"></span>
                  <%= moment(reservation.checkin).format('DD/MM/YYYY') %>
                  <i class="fa fa-arrow-right" aria-hidden="true"></i> 
                  <%= moment(reservation.checkout).format('DD/MM/YYYY') %>
                </label>
              </div>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <label for="price"><i class="fas fa-bed"></i> Costo totale pernottamenti:</label>
              </div>
              <span>+<%= reservation.stay_cost %>€</span>          
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <label for="price"><i class="fas fa-house-user"></i> Tassa di soggiorno:</label>
              </div>
              <span>+<%= reservation.city_tax %>€</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <label for="price"><i class="fas fa-concierge-bell"></i> Costi del servizio: </label>
              </div>
              <span>+<%= reservation.service_cost %>€</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <label for="price"><i class="fa fa-bath" aria-hidden="true"></i> Costi di pulizia: </label>
              </div>
              <span>+<%= reservation.cleaning_cost %>€</span>
            </li>

            <li class="list-group-item d-flex justify-content-between">
              <span>Totale </span>
              <strong><%= reservation.total_cost %>€</strong>
            </li>

          </ul>

    </div>

  </div>
</div>

<script src="/scripts/accordion-item.js"></script>

<script>

  $(document).click(function(event) {
    if(event.target.getAttribute("type") != "submit")
      event.preventDefault();
  });

  $(document).ready(function() {

    let count = 1;

    $("#add-guest-form").click(function(event) {

      let accordion = getAccordion(count);

      $.get("/customer-data-form.ejs", function(data) {
        $("#guests-forms").append($.parseHTML(accordion));
        $(`#card-body-${count}`).html($.parseHTML(data));
        $(`#remove-button-${count}`).click(function(event) {
          let id = event.target.getAttribute("data-id");
          $(`#customer-card-${id}`).remove();
        })
        count++;
      }, 'html');
    });
    
  });
</script>